<div class="history-container">
    <div class="page-header">
        <h2><i class="fa fa-history"></i> Trading History</h2>
        <p>View and Analyze All Transactions</p>
    </div>

    <div ng-if="error" class="alert alert-danger alert-dismissible" role="alert">
        <button type="button" class="close" ng-click="error = null">
            <span aria-hidden="true">&times;</span>
        </button>
        {{error}}
    </div>

    <!-- Filter and Statistics Section -->
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <i class="fa fa-filter"></i> Filters & Statistics
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <!-- Symbol Filter -->
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="symbolFilter">Filter by Symbol</label>
                                <select class="form-control" id="symbolFilter" 
                                        ng-model="symbolFilter" 
                                        ng-change="applyFilters()">
                                    <option value="">All Symbols</option>
                                    <option value="ETHUSDT">ETH/USDT</option>
                                    <option value="BTCUSDT">BTC/USDT</option>
                                </select>
                            </div>
                        </div>

                        <!-- Statistics -->
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="stat-box">
                                        <div class="stat-label">Total Trades</div>
                                        <div class="stat-value">{{trades.length}}</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-box stat-success">
                                        <div class="stat-label">Buy Orders</div>
                                        <div class="stat-value">{{stats.buyCount}}</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-box stat-danger">
                                        <div class="stat-label">Sell Orders</div>
                                        <div class="stat-value">{{stats.sellCount}}</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-box">
                                        <div class="stat-label">Total Volume</div>
                                        <div class="stat-value">${{stats.totalVolume | number:2}}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Volume Breakdown -->
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <i class="fa fa-pie-chart"></i> Volume Breakdown
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="volume-stat">
                                <small class="text-muted">Total Volume</small>
                                <h4>${{stats.totalVolume | number:2}}</h4>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="volume-stat success">
                                <small class="text-muted">Buy Volume</small>
                                <h4 class="text-success">${{stats.buyVolume | number:2}}</h4>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="volume-stat danger">
                                <small class="text-muted">Sell Volume</small>
                                <h4 class="text-danger">${{stats.sellVolume | number:2}}</h4>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="volume-stat">
                                <small class="text-muted">Net Flow</small>
                                <h4 ng-class="{'text-success': stats.buyVolume > stats.sellVolume, 'text-danger': stats.sellVolume > stats.buyVolume}">
                                    ${{(stats.buyVolume - stats.sellVolume) | number:2}}
                                </h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Trades Table -->
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-6">
                            <h3 class="panel-title">
                                <i class="fa fa-list"></i> All Trades
                            </h3>
                        </div>
                        <div class="col-md-6 text-right">
                            <button class="btn btn-sm btn-info" ng-click="refreshTrades()">
                                <i class="fa fa-refresh"></i> Refresh
                            </button>
                            <button class="btn btn-sm btn-default" ng-click="toggleSortOrder()">
                                <i class="fa" ng-class="{'fa-arrow-up': !reverseSort, 'fa-arrow-down': reverseSort}"></i>
                                Sort
                            </button>
                        </div>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th ng-click="setSortColumn('timestamp')">
                                        <a href="">
                                            Time
                                            <i class="fa fa-sort" ng-if="sortColumn !== 'timestamp'"></i>
                                            <i class="fa fa-sort-up" ng-if="sortColumn === 'timestamp' && !reverseSort"></i>
                                            <i class="fa fa-sort-down" ng-if="sortColumn === 'timestamp' && reverseSort"></i>
                                        </a>
                                    </th>
                                    <th ng-click="setSortColumn('type')">
                                        <a href="">
                                            Type
                                            <i class="fa fa-sort" ng-if="sortColumn !== 'type'"></i>
                                            <i class="fa fa-sort-up" ng-if="sortColumn === 'type' && !reverseSort"></i>
                                            <i class="fa fa-sort-down" ng-if="sortColumn === 'type' && reverseSort"></i>
                                        </a>
                                    </th>
                                    <th ng-click="setSortColumn('symbol')">
                                        <a href="">
                                            Symbol
                                            <i class="fa fa-sort" ng-if="sortColumn !== 'symbol'"></i>
                                            <i class="fa fa-sort-up" ng-if="sortColumn === 'symbol' && !reverseSort"></i>
                                            <i class="fa fa-sort-down" ng-if="sortColumn === 'symbol' && reverseSort"></i>
                                        </a>
                                    </th>
                                    <th ng-click="setSortColumn('quantity')">
                                        <a href="">
                                            Quantity
                                            <i class="fa fa-sort" ng-if="sortColumn !== 'quantity'"></i>
                                            <i class="fa fa-sort-up" ng-if="sortColumn === 'quantity' && !reverseSort"></i>
                                            <i class="fa fa-sort-down" ng-if="sortColumn === 'quantity' && reverseSort"></i>
                                        </a>
                                    </th>
                                    <th ng-click="setSortColumn('price')">
                                        <a href="">
                                            Price
                                            <i class="fa fa-sort" ng-if="sortColumn !== 'price'"></i>
                                            <i class="fa fa-sort-up" ng-if="sortColumn === 'price' && !reverseSort"></i>
                                            <i class="fa fa-sort-down" ng-if="sortColumn === 'price' && reverseSort"></i>
                                        </a>
                                    </th>
                                    <th ng-click="setSortColumn('totalAmount')">
                                        <a href="">
                                            Total
                                            <i class="fa fa-sort" ng-if="sortColumn !== 'totalAmount'"></i>
                                            <i class="fa fa-sort-up" ng-if="sortColumn === 'totalAmount' && !reverseSort"></i>
                                            <i class="fa fa-sort-down" ng-if="sortColumn === 'totalAmount' && reverseSort"></i>
                                        </a>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="trade in trades | orderBy:sortColumn:reverseSort">
                                    <td>{{trade.timestamp | date:'MM/dd/yyyy HH:mm:ss'}}</td>
                                    <td>
                                        <span ng-if="trade.type === 'BUY'" class="label label-success">
                                            <i class="fa fa-arrow-up"></i> BUY
                                        </span>
                                        <span ng-if="trade.type === 'SELL'" class="label label-danger">
                                            <i class="fa fa-arrow-down"></i> SELL
                                        </span>
                                    </td>
                                    <td><strong>{{trade.symbol}}</strong></td>
                                    <td>{{trade.quantity | number:8}}</td>
                                    <td>${{trade.price | number:2}}</td>
                                    <td>
                                        <strong>${{trade.totalAmount | number:2}}</strong>
                                    </td>
                                </tr>
                                <tr ng-if="!trades || trades.length === 0">
                                    <td colspan="6" class="text-center text-muted">
                                        <i class="fa fa-inbox"></i> No trades found
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="text-center text-muted" ng-if="trades && trades.length > 0">
                        <small>
                            Showing {{trades.length}} trade(s)
                            <span ng-if="symbolFilter">(filtered: {{symbolFilter}})</span>
                            <br>
                            Last updated: {{lastUpdate | date:'HH:mm:ss'}}
                            <br>
                            Auto-refreshing every 10 seconds
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .stat-box {
        padding: 15px;
        background-color: #f5f5f5;
        border-radius: 4px;
        margin-bottom: 10px;
    }
    .stat-box.stat-success {
        background-color: #dff0d8;
    }
    .stat-box.stat-danger {
        background-color: #f2dede;
    }
    .stat-label {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
    }
    .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #333;
    }
    .volume-stat {
        padding: 15px;
        text-align: center;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
</style>
